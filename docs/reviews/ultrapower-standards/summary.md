# 评审摘要: ultrapower 全链路规范体系

> 聚合日期：2026-02-26
> 聚合人：axiom-review-aggregator（首席 PM）
> 草稿版本：Draft v0.1
> 输出：docs/prd/ultrapower-standards-rough.md

---

## 1. 关键决策

| 冲突 | 仲裁角色 | 决策结果 |
|------|---------|---------|
| PRD 只定义规范名称，无实质内容 | Critic（安全/质量，最高优先级） | Rough PRD 必须为每个 P0 规范条目提供至少 3 条可执行规则草稿，不得仅列文件名 |
| 状态文件路径遍历风险未处理 | Critic（安全边界不可协商） | 新增"安全边界"章节，要求 mode 参数白名单校验，禁止路径拼接 |
| Agent 状态机存在死状态（ERROR 无强制退出） | Critic + Tech（技术可行性） | 状态机增加 ERROR 超时强制转换（30s）、WAITING 超时（5min）、ZOMBIE 清理状态 |
| Hook 类型分类：PRD 写 3 类，实际代码有 15 类 | Domain（领域知识，逻辑正确性） | 以 bridge.ts 的 HookType 为权威来源，规范覆盖全部 15 个 hook 类型 |
| Stop 阶段优先级规则缺失 | Domain（领域知识） | 明确 Stop 阶段优先级链：Ralph > Ultrawork > Todo-Continuation |
| P1 Skill 决策树 ROI 高于 P0，应并行 | Product（战略对齐） | Skill 决策树与 P0 并行交付，不再排在 P0 之后 |
| Impact Scope 遗漏 5 个文件 | Tech（技术可行性，硬性约束） | 补充 state-machine.md、hook-execution-order.md、agent-lifecycle.md、anti-patterns.md、standards/README.md |
| 验收标准 AC-01/AC-04 是存在性检查而非质量检查 | Critic（质量不可协商） | 重写全部 AC，改为可量化的质量指标 |
| 决策树无原型设计 | UX（用户体验优化） | PRD 中附决策树伪代码原型，定义 3 层结构和第一层分支维度 |
| Windows 平台文件锁语义未处理 | Critic + Tech（安全 + 技术约束） | 非功能需求增加 Windows 平台兼容性要求，P0 锁策略给出跨平台方案 |
| 规范无执行机制（无 CI 门禁） | Product（战略对齐） | 明确哪些规范通过自动化强制（CI），哪些通过 review 流程保障；CI 门禁列为 v1 必交付项 |
| 跳过"审计现有实现"直接写规范 | Critic（根本性质量问题） | 新增 P0 前置任务：审计现有 35 个 hook 和 49 个 agent 实现，规范从代码反向提取 |

---

## 2. 范围变更

### 移除

- 原 P0/P1/P2 同时作为 MVP 的三层结构（范围过大）
- 原 AC-01"并发场景有明确处理指引"（存在性检查，替换为可量化版本）
- 原 AC-04"三类 BUG 来源均有对应规范"（与 AC-01 重叠，替换为质量指标）
- 原状态机图（存在死状态，已重新设计）
- 原 Hook 三分类（PreToolUse/PostToolUse/Stop）（与代码不符，已替换）

### 新增

- P0 前置任务：现有实现审计（35 个 hook + 49 个 agent）
- 安全边界章节：路径遍历防护、hook 输入消毒、状态文件权限
- 完整 Agent 状态机：含 ZOMBIE 状态、ERROR 超时、WAITING 超时、成本超限、死锁检测
- 15 类 HookType 完整分类（来自 bridge.ts）
- Stop 阶段优先级链规则
- SDK 平台限制说明（success 字段已废弃）
- Agent 边界情况矩阵（超时/孤儿/成本超限/死锁）
- Windows 平台差异说明（rename 语义、文件锁）
- 规范执行机制（CI 门禁策略）
- 规范版本化策略（与 npm 版本号绑定）
- 用户旅程地图（三类用户：新用户/日常用户/贡献者）
- 系统反馈标准（进度/成功/错误提示格式）
- Skill 决策树原型（3 层结构，第一层基于用户意图）
- Impact Scope 补充 5 个遗漏文件
- 新增 AC-05（系统反馈标准化）、AC-06（规范执行机制）

### 优先级调整

- Skill 调用决策树：从 P1 提升，与 P0 并行交付
- 贡献检查清单：从 P2 提升为 P1 子集（CI 可验证，形成闭环）
- 自动化规范检查工具：从"v2 延期"调整为"v1 CI 门禁"（无执行机制的规范无价值）

---

## 3. 放弃项（经仲裁明确不纳入）

| 放弃项 | 放弃理由 |
|--------|---------|
| 英文版规范文档 | 当前用户群以中文为主，v2 延期 |
| 视频教程/交互式引导 | 超出文档范围，v2 延期 |
| 规范覆盖率度量仪表盘 | 超出 v1 范围 |
| 历史 BUG 的规范回溯标注 | 工作量过大，v2 延期 |
| 模板转为可执行脚手架脚本 | 技术债务 TD-3，v2 处理 |

---

## 4. 仲裁层级应用记录

本次仲裁共触发 12 个冲突点，按优先级层级处理如下：

- 安全（Critic）覆盖其他所有意见：路径遍历、hook 注入、状态文件权限 — 3 项
- 技术可行性（Tech）作为硬性约束：Impact Scope 补充、Windows 兼容性、原子写入工具函数 — 3 项
- 战略对齐（Product）调整优先级：Skill 决策树并行、CI 门禁列为 v1、MVP 范围收窄 — 3 项
- 逻辑正确性（Domain）修正技术描述：15 类 HookType、Stop 优先级链、SDK 限制 — 3 项
- 用户体验（UX）补充设计细节：决策树原型、用户旅程、系统反馈标准 — 纳入但不覆盖上层决策
